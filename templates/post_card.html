<article class="post-card" id="post-{{ post.id }}">

  {# Header #}
  <div class="post-header">
    <a href="/profile/{{ post.username }}">
      {% if post.get('avatar_img') or (post is mapping and post['avatar_img']) %}
        <img src="/static/uploads/{{ post.avatar_img }}" class="avatar avatar-sm" style="object-fit:cover;">
      {% else %}
        <div class="avatar avatar-sm" style="background:{{ post.avatar_color }}">{{ post.username[0].upper() }}</div>
      {% endif %}
    </a>
    <div class="post-author-info">
      <a href="/profile/{{ post.username }}" class="post-author-name">{{ post.username }}</a>
      <div class="post-time">{{ post.created_at }}</div>
    </div>


  
  
  
  {# Media #}
  {% if media %}
    <div class="post-media-grid post-media-{{ media|length }}">
      {% for m in media %}
        {% if m.media_type == 'image' %}
          <div class="post-media-item"><img src="/static/uploads/{{ m.filename }}" alt="—Ñ–æ—Ç–æ" loading="lazy"></div>
        {% elif m.media_type == 'video' %}
          <div class="post-media-item"><video src="/static/uploads/{{ m.filename }}" controls preload="metadata" playsinline></video></div>
        {% elif m.media_type == 'audio' %}
          <div class="post-audio-wrap">
            <div class="post-audio-icon">üéµ</div>
            <div class="post-audio-info">
              <div class="post-audio-label">–ê—É–¥—ñ–æ</div>
              <audio src="/static/uploads/{{ m.filename }}" controls></audio>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  {# Text + double-tap #}
  <div class="post-tappable" data-post-id="{{ post.id }}" style="position:relative;">
    {% if post.content %}<div class="post-text-content">{{ post.content }}</div>{% endif %}
    <span class="double-tap-heart">‚ù§Ô∏è</span>
  </div>

  {# Actions ‚Äî –∑ —Ä–µ–∞–∫—Ü—ñ—è–º–∏ #}
  <div class="post-actions">
    {# Like –∑ –¥–æ–≤–≥–∏–º –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è–º –¥–ª—è —Ä–µ–∞–∫—Ü—ñ–π #}
    <div class="reaction-wrap" data-post-id="{{ post.id }}">
      <button class="post-action-btn like-btn-ajax {% if post.user_liked %}liked{% endif %}"
              data-post-id="{{ post.id }}"
              data-long-press="{{ post.id }}">
        <span class="heart-icon">{% if post.user_liked %}‚ù§Ô∏è{% else %}ü§ç{% endif %}</span>
      </button>
      {# Reaction picker #}
      <div class="reaction-picker" id="reactions-{{ post.id }}">
        {% for emoji in ['‚ù§Ô∏è','üòÇ','üòÆ','üò¢','üò°','üî•'] %}
          <button class="reaction-btn" onclick="pickReaction({{ post.id }}, '{{ emoji }}')">{{ emoji }}</button>
        {% endfor %}
      </div>
    </div>

    <button class="post-action-btn" style="font-size:1.1rem;" onclick="toggleComments({{ post.id }})">üí¨</button>
    <button class="post-action-btn" style="font-size:1.1rem;" onclick="sharePost({{ post.id }})">üì§</button>
    <button class="post-action-btn post-save-btn" style="font-size:1.1rem;">üîñ</button>
  </div>

  {# Likes count #}
  {% if post.like_count > 0 %}
    <div class="post-likes" id="likes-{{ post.id }}">
      {{ post.like_count }} {% if post.like_count == 1 %}–≤–ø–æ–¥–æ–±–∞–Ω–Ω—è{% else %}–≤–ø–æ–¥–æ–±–∞–Ω—å{% endif %}
    </div>
  {% else %}
    <div class="post-likes" id="likes-{{ post.id }}" style="display:none;"></div>
  {% endif %}

  {# Comments toggle #}
  <button class="view-comments-btn" onclick="toggleComments({{ post.id }})">
    {% if post.comment_count > 0 %}
      –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ ({{ post.comment_count }})
    {% else %}
      <span style="color:var(--text-3);">–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</span>
    {% endif %}
  </button>

  {# Comments section #}
  <div class="comments-section" id="comments-{{ post.id }}">
    <div class="comments-list"></div>
    <div class="comment-input-row" data-post-id="{{ post.id }}">
      {% if session.get('avatar_img') %}
        <img src="/static/uploads/{{ session.avatar_img }}" class="avatar avatar-xs" style="object-fit:cover;">
      {% else %}
        <div class="avatar avatar-xs" style="background:var(--accent)">{{ session.username[0].upper() }}</div>
      {% endif %}
      <input class="comment-input" type="text" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä...">
      <button class="comment-post-btn">–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
    </div>
  </div>

</article>