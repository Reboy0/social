{% extends 'base.html' %}
{% block title %}–°—Ç—Ä—ñ—á–∫–∞ ‚Äî MySocial{% endblock %}

{% block body %}
<div class="app-container">

  {# ‚ïê‚ïê‚ïê LEFT SIDEBAR (desktop) ‚ïê‚ïê‚ïê #}
  <aside class="sidebar-left">
    <div class="sidebar-logo">MySocial</div>

    <a href="/" class="nav-item active">
      <span class="nav-icon">üè†</span> –°—Ç—Ä—ñ—á–∫–∞
    </a>
    <a href="/search" class="nav-item">
      <span class="nav-icon">üîç</span> –ü–æ—à—É–∫
    </a>
    <a href="/notifications" class="nav-item">
      <span class="nav-icon">üîî</span> –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è
      <span class="nav-badge" data-notif>0</span>
    </a>
    <a href="/profile/{{ session.username }}" class="nav-item">
      <span class="nav-icon">üë§</span> –ü—Ä–æ—Ñ—ñ–ª—å
    </a>

    <button class="sidebar-post-btn" onclick="openModal('modal-post')">+ –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Å—Ç</button>

    <a href="/profile/{{ session.username }}" class="sidebar-user">
      <div class="avatar avatar-sm" style="background:{{ session.get('accent','#6366f1') }}">
        {{ session.username[0].upper() }}
      </div>
      <div class="sidebar-user-info">
        <div class="sidebar-username">{{ session.username }}</div>
        <div class="sidebar-handle">@{{ session.username }}</div>
      </div>
    </a>
  </aside>

  {# ‚ïê‚ïê‚ïê MAIN FEED ‚ïê‚ïê‚ïê #}
  <main class="main-feed">

    {# Top bar (mobile) #}
    <div class="top-bar">
      <div class="top-bar-logo">MySocial</div>
      <div class="top-bar-actions">
        <a href="/notifications" class="icon-btn">
          üîî
          <span class="notif-dot" data-notif></span>
        </a>
        <button class="icon-btn" onclick="openModal('modal-post')">‚ûï</button>
      </div>
    </div>

    {# Stories #}
    <div class="stories-bar">
      <div class="stories-inner">
        {# Add story button #}
        <div class="story-item" onclick="openModal('modal-story')">
          <button class="story-add-btn">Ôºã</button>
          <span class="story-username">–í–∞—à–∞ —Å—Ç–æ—Ä—ñ—Å</span>
        </div>

        {% for story in stories %}
          <a href="/story/{{ story.id }}" class="story-item" style="text-decoration:none;">
            <div class="story-avatar-wrap">
              <div class="avatar-story-ring {% if story.viewed %}viewed{% endif %}">
                <div class="avatar avatar-md" style="background:{{ story.avatar_color }}">
                  {{ story.username[0].upper() }}
                </div>
              </div>
            </div>
            <span class="story-username">{{ story.username }}</span>
          </a>
        {% endfor %}
      </div>
    </div>

    {# Posts #}
    {% if not posts %}
      <div class="empty-state">
        <div class="empty-icon">üì±</div>
        <div class="empty-text">–°—Ç—Ä—ñ—á–∫–∞ –ø–æ—Ä–æ–∂–Ω—è</div>
        <div class="empty-sub">–ü—ñ–¥–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ –∫–æ–≥–æ—Å—å –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–∏–π –ø–æ—Å—Ç</div>
      </div>
    {% endif %}

    {% for post in posts %}
    <article class="post-card">
      <div class="post-header">
        <a href="/profile/{{ post.username }}">
          <div class="avatar avatar-sm" style="background:{{ post.avatar_color }}">
            {{ post.username[0].upper() }}
          </div>
        </a>
        <div class="post-author-info">
          <a href="/profile/{{ post.username }}" class="post-author-name">{{ post.username }}</a>
          <div class="post-time">{{ post.created_at }}</div>
        </div>
        <button class="post-menu-btn">¬∑¬∑¬∑</button>
      </div>

      {# Double-tap area #}
      <div class="post-tappable" data-post-id="{{ post.id }}" style="position:relative;">
        <div class="post-text-content">{{ post.content }}</div>
        <span class="double-tap-heart">‚ù§Ô∏è</span>
      </div>

      <div class="post-actions">
        <button class="post-action-btn like-btn-ajax {% if post.user_liked %}liked{% endif %}"
                data-post-id="{{ post.id }}">
          <span class="heart-icon">{% if post.user_liked %}‚ù§Ô∏è{% else %}ü§ç{% endif %}</span>
        </button>
        <button class="post-action-btn view-comments-btn" data-post-id="{{ post.id }}"
                style="font-size:1.1rem;">üí¨</button>
        <button class="post-action-btn" style="font-size:1.1rem;">üì§</button>
        <button class="post-action-btn post-save-btn" style="font-size:1.1rem;">üîñ</button>
      </div>

      {% if post.like_count > 0 %}
        <div class="post-likes">
          {{ post.like_count }} {% if post.like_count == 1 %}–≤–ø–æ–¥–æ–±–∞–Ω–Ω—è{% else %}–≤–ø–æ–¥–æ–±–∞–Ω—å{% endif %}
        </div>
      {% endif %}

      {% if post.comment_count > 0 %}
        <button class="view-comments-btn" data-post-id="{{ post.id }}">
          –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ ({{ post.comment_count }})
        </button>
      {% else %}
        <button class="view-comments-btn" data-post-id="{{ post.id }}" style="color:var(--text-3);">
          –î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä
        </button>
      {% endif %}

      {# Comments section #}
      <div class="comments-section" id="comments-{{ post.id }}">
        <div class="comments-list"></div>
        <div class="comment-input-row" data-post-id="{{ post.id }}">
          <div class="avatar avatar-xs" style="background:{{ session.get('accent','#6366f1') }}">
            {{ session.username[0].upper() }}
          </div>
          <input class="comment-input" type="text" placeholder="–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä...">
          <button class="comment-post-btn">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
        </div>
      </div>
    </article>
    {% endfor %}

  </main>

  {# ‚ïê‚ïê‚ïê RIGHT SIDEBAR (desktop) ‚ïê‚ïê‚ïê #}
  <aside class="sidebar-right">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
      <div class="avatar avatar-md" style="background:{{ session.get('accent','#6366f1') }}">
        {{ session.username[0].upper() }}
      </div>
      <div>
        <div style="font-weight:700;font-size:0.9rem;">{{ session.username }}</div>
        <a href="/profile/{{ session.username }}" style="color:var(--text-2);font-size:0.8rem;">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø—Ä–æ—Ñ—ñ–ª—é</a>
      </div>
    </div>

    {% if recommended %}
      <div class="sidebar-right-title">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ</div>
      {% for user in recommended %}
        <div class="suggest-item">
          <a href="/profile/{{ user.username }}">
            <div class="avatar avatar-sm" style="background:{{ user.avatar_color }}">
              {{ user.username[0].upper() }}
            </div>
          </a>
          <div class="suggest-info">
            <a href="/profile/{{ user.username }}" class="suggest-name">{{ user.username }}</a>
            <div class="suggest-sub">{{ user.followers_count }} –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤</div>
          </div>
          <button class="suggest-follow-btn follow-btn-ajax" data-user-id="{{ user.id }}">
            –ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å
          </button>
        </div>
      {% endfor %}
    {% endif %}
  </aside>

</div>

{# ‚ïê‚ïê‚ïê BOTTOM NAV (mobile) ‚ïê‚ïê‚ïê #}
<nav class="bottom-nav">
  <a href="/" class="bottom-nav-item active">
    <span class="bnav-icon">üè†</span>
    <span>–°—Ç—Ä—ñ—á–∫–∞</span>
  </a>
  <a href="/search" class="bottom-nav-item">
    <span class="bnav-icon">üîç</span>
    <span>–ü–æ—à—É–∫</span>
  </a>
  <div class="bottom-nav-post">
    <button class="bottom-nav-post-btn" onclick="openModal('modal-post')">Ôºã</button>
  </div>
  <a href="/notifications" class="bottom-nav-item" style="position:relative;">
    <span class="bnav-icon">üîî</span>
    <span>–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</span>
    <span class="bnav-badge" data-notif></span>
  </a>
  <a href="/profile/{{ session.username }}" class="bottom-nav-item">
    <span class="bnav-icon">üë§</span>
    <span>–ü—Ä–æ—Ñ—ñ–ª—å</span>
  </a>
</nav>

{% endblock %}