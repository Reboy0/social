<!DOCTYPE html>
<html lang="uk" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°—Ç–æ—Ä—ñ—Å ‚Äî MySocial</title>
  <link rel="stylesheet" href="/static/css/main.css">
</head>
<body data-init-theme="dark" data-init-accent="#6366f1" style="background:#000;overflow:hidden;">

<div class="story-viewer">
  <div class="story-viewer-bg" onclick="window.location.href='/'"></div>
  <div class="story-card" style="background:{{ story.bg_color }};">

    <div class="story-progress">
      <div class="story-progress-bar" data-next-id="{{ next_id or '' }}"></div>
    </div>

    <div class="story-header">
      {% if story.avatar_img %}
        <img src="/static/uploads/{{ story.avatar_img }}" class="avatar avatar-sm" style="object-fit:cover;">
      {% else %}
        <div class="avatar avatar-sm" style="background:rgba(255,255,255,0.3);">{{ story.username[0].upper() }}</div>
      {% endif %}
      <a href="/profile/{{ story.username }}" style="color:white;font-weight:600;font-size:0.875rem;text-decoration:none;">{{ story.username }}</a>
      <span style="color:rgba(255,255,255,0.5);font-size:0.75rem;margin-left:4px;">{{ story.created_at }}</span>

      {% if session.user_id == story.user_id %}
        <button onclick="deleteThisStory({{ story.id }})"
                style="margin-left:8px;background:rgba(255,255,255,0.15);border:none;border-radius:8px;color:white;padding:4px 10px;cursor:pointer;font-size:0.8rem;">
          üóë
        </button>
      {% endif %}

      <a href="/" class="story-close" style="margin-left:auto;">‚úï</a>
    </div>

    <div class="story-body">
      <div class="story-text">{{ story.content }}</div>
    </div>

  </div>
</div>

<script src="/static/js/main.js"></script>
<script>
async function deleteThisStory(id) {
  if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–æ—Ä—ñ—Å?')) return;
  try {
    const res = await fetch(`/api/stories/${id}/delete`, {method:'POST'});
    const data = await res.json();
    if (data.deleted) window.location.href = '/';
  } catch(e) { alert('–ü–æ–º–∏–ª–∫–∞'); }
}
</script>
</body>
</html>